# =========================
# ðŸ”§ CAMPUSXCHANGE .htaccess COMPLETE FIXED
# =========================

# Enable mod_rewrite
RewriteEngine On

# Redirect www to non-www
RewriteCond %{HTTP_HOST} ^www\.campusxchange\.wuaze\.com [NC]
RewriteRule ^(.*)$ https://campusxchange.wuaze.com/$1 [L,R=301]

# =========================
# Clean URLs
# =========================

# Root pages
RewriteRule ^$ index.php [L]
RewriteRule ^home$ index.php [L]
RewriteRule ^about$ about.php [L]
RewriteRule ^lettalk$ lettalk.php [L]
RewriteRule ^internship-program$ internship.php [L]
RewriteRule ^privacy-policyandterms$ privacy.php [L]

# Handouts subfolder
RewriteRule ^handouts/notes$ handouts/notes.php [L]
RewriteRule ^handouts/blog$ handouts/blog.php [L]
RewriteRule ^handouts/assignment$ handouts/assignment.php [L]
RewriteRule ^handouts/courses$ handouts/courses.php [L]

# Services subfolder
RewriteRule ^services/web-development$ services/webdevelopment.php [L]
RewriteRule ^services/seo$ services/seo.php [L]

# Internship subfolder
RewriteRule ^internship/apply$ internship/apply.php [L]
RewriteRule ^internship/verification$ internship/verification.php [L]
RewriteRule ^internship/verifiedintern$ internship/verifiedintern.php [L]

# Dashboard control
RewriteRule ^dashboard/clients$ dashboard/web_client.php [L]
RewriteRule ^dashboard/verified-intern$ dashboard/verified_intern.php [L]
RewriteRule ^dashboard/applied-intern$ dashboard/applied_intern.php [L]
RewriteRule ^dashboard/notes$ dashboard/notes.php [L]
RewriteRule ^dashboard/admin$ dashboard/admin.php [L]

# Sitemap
RewriteRule ^sitemap$ sitemap.php [L]

# Prevent redirect loop for 404.php itself
RewriteCond %{REQUEST_URI} !^/404\.php$

# If requested file or directory does NOT exist
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Redirect all non-existent URLs to 404.php
RewriteRule . /404.php [L]

# Set proper 404 status for Apache
ErrorDocument 404 /404.php

# =========================
# ðŸ”’ CAMPUSXCHANGE SECURITY HEADERS (Fixed)
# =========================
<IfModule mod_headers.c>

    # Prevent MIME-type sniffing
    Header set X-Content-Type-Options "nosniff"

    # Protect from clickjacking
    Header set X-Frame-Options "SAMEORIGIN"

    # Basic XSS protection
    Header set X-XSS-Protection "1; mode=block"

    # Hide detailed referrer info
    Header set Referrer-Policy "strict-origin-when-cross-origin"

    # Restrict browser features (optional)
    Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"

    # Cross-origin policies (allow external embeds)
    Header set Cross-Origin-Embedder-Policy "unsafe-none"
    Header set Cross-Origin-Opener-Policy "same-origin-allow-popups"
    Header set Cross-Origin-Resource-Policy "cross-origin"

    # Content Security Policy (allow Google Maps & YouTube)
Header set Content-Security-Policy "default-src 'self' https: data:; script-src 'self' 'unsafe-inline' https://www.youtube.com https://maps.googleapis.com https://maps.gstatic.com https://cdnjs.cloudflare.com https://use.fontawesome.com https://kit.fontawesome.com; style-src * 'unsafe-inline'; img-src 'self' data: https:; frame-src https://www.youtube.com https://www.google.com https://wuaze.com https://pankajkumardas.netlify.app/ https://pankajdas0025.github.io/Tmu-Notes/ https://your-coaching-website.netlify.app https://www.google.com/maps https://maps.google.com; frame-ancestors 'self';"


</IfModule>

# =========================
# ðŸš« Prevent Directory Listing
# =========================
Options -Indexes

# Enable CORS for all resources
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
</IfModule>
